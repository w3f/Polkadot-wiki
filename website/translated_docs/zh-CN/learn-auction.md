---
id: learn-auction
title: 平行链插槽拍卖
sidebar_label: 平行链插槽拍卖
---

Polkadot 的平行链插槽通过[蜡烛(candle)拍卖](https://en.wikipedia.org/wiki/Candle_auction)进行出售，该拍卖经过了轻微修 改以确保在区块链上执行安全。

## 蜡烛(Candle)拍卖机制

蜡烛拍卖是公开拍卖的一种形式，投标人提交的出价越来越高，拍卖结束时出价最高的投标人被视为获胜者。

蜡烛拍卖法最初是在16世纪使用的，用于出售船只，其名称取自"蜡烛的英寸"，而蜡烛的长度决定了拍卖的开放时间。 当火焰熄灭并且蜡烛熄灭时，拍卖会突然终止，这时的长期竞标将获胜。

在线使用蜡烛拍卖法时，它们需要一个随机数来决定终止的时间。

平行链插槽拍卖与正常的蜡烛拍卖法会略有不同，因为它不使用随机数来决定其开放阶段的持续时间。 取而代之的是，它具有已知的开放阶段，并将被追溯确定(在正常关闭时)在过去的某个时刻结束。 因此在公开阶段，投标将继续被接受，但是以后的投标有更高的失败概率，因为追溯确定的关闭时刻可能早于提交投标的时间。

## 为什么要使用蜡烛拍卖?

区块链系统的开放性和透明性打开了传统拍卖形式中不存在的攻击媒介。当通过互联网或区块链实施时，特别是普通的公开拍卖容易受到_拍卖狙击_的攻击。

当已知拍卖结束且竞标者不愿提早竞标其真实价格时，便会进行拍卖狙击，以期支付比实际价格低的价格。

例如爱丽丝在拍卖会上可能会为某物品估价30美元。 她提交了10美元的初始出价，希望以较低的价格购买这些物品。 爱丽丝的策略是逐步提高出价，直到超过其30美元的真实价值。 另一个竞标者夏娃对同一物品的估价为11美元。 夏娃的策略是持续观看拍卖结果，并在最后一秒提交11美元的出价。 在拍卖结束之前，爱丽丝将没有时间响应此出价，并且会失去该物品。 拍卖机制是次优的，因为它尚未发现商品的真实价格，而且商品也未归给估价最高的人员。

在区块链上，这个问题可能更加严重，因为它可能给出块者提供机会，通过自己添加和/或忽略其他出价来窥探最后一个区块的任何拍卖。恶意竞标者或出块者还可能通过狙击拍卖来_grief_诚实的竞标者。

因此 [ Vickrey 拍卖](https://en.wikipedia.org/wiki/Vickrey_auction)，是第二种价格拍卖，其中出价被隐藏起来，并且仅在以后的阶段才会显示，已经成为备受推崇的机制。 例如它被实现为在[ ENS ](https://ens.domains)上拍卖人类可读名称的机制。 蜡烛拍卖法是另一种不需要两步提交和披露计划（Vickrey拍卖的主要组成部分）的解决方案，因此允许智能合约参与。

蜡烛拍卖允许每个人始终知道出价的状态，但不能知道何时确定拍卖已"结束"。 这有助于确保投标人愿意尽早出价其真实出价。 否则他们可能会发现自己在甚至竞标之前就已确定拍卖已经"结束"。

## Polkadot 如何使用它

Polkadot 将使用基于 VRF 的_随机信标_，VRF 也已在协议的其它地方使用。VRF 将提供随机性基础，该基础将追溯确定拍卖的"结束时间"。

当账户出价时，他们可以为插槽位中的任何可用时间段或范围出价，但是如果平行链(具有相同的STF)出价，则该平行链必须在连续的时期或范围内竞标，直至其已经占据的时期。它们将无法竞标重叠的插槽位(同一条平行链不能同时获得)，并且如果两者之间存在差距，他们将无法竞标未来的插槽位。如果平行链已达到其插槽持续时间的结束后重新启动，则需要从新的创世(可能是所有旧状态的快照)重新启动，并且需要从外部帐户出价 。

插槽的持续时间上限为2年，每期分为6个月。平行链可以在时隙持续时间的任何连续范围内租用一个时隙。平行链可能会随时间租用一个以上的插槽，这意味着他们可以通过租用连续的插槽，将租约延长至 Polkadot 超过2年的插槽期限。

## 竞标如何运作？

```
创世的平行链插槽

       --6 months--
       v          v
Slot A |     1    |     2    |     3     |     4     |...
Slot B |     1    |     2    |     3     |     4     |...
Slot C |__________|     1    |     2     |     3     |     4     |...
Slot D |__________|     1    |     2     |     3     |     4     |...
Slot E |__________|__________|     1     |     2     |     3     |     4     |...
       ^                                             ^
       ---------------------2 years-------------------

1-4范围的每个周期代表6个月的持续时间，共2年
```

每个平行链插槽的最长持续时间为2年。 在插槽各6个月的间隔被划分成它自己的`租赁期`。 一个`范围`是一个以上连续的`期间`。

在开始一组平行链插槽租赁之前的六个月中，将进行几次拍卖。

投标人将提交一份投标配置，以指定他们愿意锁定的 DOT 金额以及范围。 时隙范围可以是时段1-4的任何连续范围。

单个投标人的投标人配置可能如下所示：

```js
Bids[
  ({
    range: [1, 2, 3, 4],
    bond_amount: 300, //DOTs
  },
  {
    range: [1, 2],
    bond_amount: 777, //DOTs
  },
  {
    range: [2, 3, 4],
    bond_amount: 450, // DOTs
  })
];
```

获胜者选择算法将选择可能不重叠的出价，以使在平行链槽位的整个2年租赁期限内持有的 DOT 数量最大化。 这意味着在任何给定的槽位租借期内，出价最高的人可能并不总是中标（请参见下面的[示例](#compete)）。

根据 Polkadot 使用的 VRF 在每个区块处确定一个随机数。 此外每个拍卖都有一个从0开始并增加到1的阈值，将在阈值旁边检查由VRF产生的随机数，以确定该块是否是拍卖结束。 此外VRF将从最后一个时期开始选择一个区块，以获取出价状态（以减轻恶意验证者的某些类型的攻击）。

### 例子

#### 非竞争性

只有一个平行链插槽可用

爱丽丝将` 20 DOTs`的出价设置在1-2阶段。

鲍勃出价` 30 DOTs `在3-4阶段。

拍卖结束

爱丽丝会绑定` 20 DOTs`，并将在第一年拥有平行链插槽。

鲍勃绑定了` 30 DOTs`，并将在第二年拥有平行链插槽。

#### 竞争性

只有一个平行链插槽可用

对于1-4阶段，查理出价` 75个DOT `

对于3-4阶段，戴夫出价`100 DOTs`

对于1-2阶段，艾米丽出价`40 DOTs`

让我们根据算法来计算每个投标人的估价。 为此我们将保证金金额乘以投标指定范围内的期间数。

在1-4阶段，查理-75*4=300

在3-4阶段，戴夫-100 * 2 = 200

在1-2阶段，艾米丽-40 * 2 = 80

尽管根据 DOT 金额，戴夫的出价最高，但是当我们进行计算时，我们看到，由于他只出价2个在区间，他需要与出价低得多的艾米丽分享这个期间。戴夫和艾米丽的出价加在一起，其估价仅为` 280 `。

查理对整个范围的估价是`300`因此查理被授予平行链插槽的整个阶段。

## 常见问题

### 为什么每个人不竞标最大长度？

在该时段内，拍卖中的` DOTs `出价将被锁定。 这意味着将这些` DOTs `用于其他用途的可能性会带来机会成本。 对于有益于 Polkadot 的平行链，这应该使平行链和 Polkadot 中继链之间的利益保持一致。

### 这种机制如何帮助确保平行链的多样性？

将平行链槽划分为六个月间隔的方法部分地受到了以下愿望的启发: 允许更多的平行链多样性，并防止特别大且资金充足的平行链囤积插槽。 通过将每个周期设置为六个月，而将整个插槽设置为2年，该机制可以应对资金充裕的平行链，这将确保它们在租约期末获得固定的插槽，同时逐步允许其他平行链进入 生态系统占据了六个月的时间，占据未填满的6个月时段。 例如如果大型资金充裕的平行链已经获得了范围1-4的插槽，那么他们将非常有兴趣获得下一个将开放2-5的插槽。在这种机制下，平行链可以获取周期5 (因为这是它唯一需要的一个)，并允许第二个平行链插槽的范围2-4被另一个占用。

### 为什么在区块链上很难实现随机性？

对于区块链系统来说，随机性是个问题。在透明开放的网络上以不信任的方式生成随机数，其他各方必须能够在该网络中进行验证，这为行为者尝试改变或操纵随机性提供了可能性。 已经提出了一些解决方案，包括[ RANDAO ](https://github.com/randao/randao)和[可验证的随机函数](https:// zh.wikipedia.org/wiki/Verifiable_random_function)(VRFs)。后者是 Polkadot 用作随机性的基础。

## 资源

- [ 平行链分配](http://research.web3.foundation/zh-Cn/latest/polkadot/Parachain-Allocation/)-有关平行链分配的 W3F 研究页面，对该机制进行了更深入的介绍。
- [ paritytech/polkadot#239 ](https://github.com/paritytech/polkadot/pull/239) - Pull request，介绍了平行链插槽代码。
